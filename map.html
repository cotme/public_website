<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Seminary Map Plotter</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <!-- PapaParse for CSV loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  </head>
  <body>
    <div id="map"></div>

    <script>
let map;

function initMap() {
  // Initialize the map
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 39.5, lng: -98.35 }, // roughly center of continental US
    zoom: 4,
  });

  // URL of your hosted CSV file
  const csvUrl = "data.csv";

  // Create ONE shared info window
  const infoWindow = new google.maps.InfoWindow();

  // Close info window when clicking elsewhere on the map
  map.addListener("click", () => {
    infoWindow.close();
  });

const categoryColors = {
  "ATS": "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
  "ABHE": "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
  };

  // Parse CSV and plot markers
  Papa.parse(csvUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function (results) {
      results.data.forEach((row) => {
        const lat = parseFloat(row.Latitude);
        const lng = parseFloat(row.Longitude);

        if (!isNaN(lat) && !isNaN(lng)) {
          const iconURL = categoryColors[row.Accreditor] || "http://maps.google.com/mapfiles/ms/icons/green-dot.png";

          const marker = new google.maps.Marker({
            position: { lat, lng },
            map: map,
            title: row.Name || "Unnamed location",
            icon: iconURL, 
          });

          const infoHtml = `
            <div class="info-content">
              <h3>${row.Name || "Unnamed"}</h3>
              <p>Students: HC: ${row.Enrollment_HC || ""} FTE: ${row.Enrollment_FTE || ""}</p>
              <p>Faculty: FT: ${row.Faculty_FT || ""} FTE: ${row.Faculty_FTE || ""}</p>
              <p>Endowment: ${row.LT_Invest || ""}</p>
              <p><em>${row.Denomination || ""}</em></p>
            </div>
          `;

          marker.addListener("click", () => {
            infoWindow.setContent(infoHtml);
            infoWindow.open(map, marker);
          });
        }
      });
    },
  });
}

    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmyZjAxHjl77JcgaR_wtug3PlBz22GIgc&callback=initMap"></script>
  </body>
</html>
